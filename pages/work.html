<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="../assets/css/reset.css">
    <link rel="stylesheet" href="../assets/css/style.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.4.2/gsap.min.js"></script>
    <script src="../assets/js/mosaic.js"></script>
    <script src="../assets/js/transition.js"></script>
    <script src="../assets/js/main.js"></script>

</head>

<body>
    <div id="wrap">
        <div class="transition-container from-top">
            <span class="tile"></span>
            <span class="tile"></span>
            <span class="tile"></span>
            <span class="tile"></span>
            <span class="tile"></span>
            <span class="tile"></span>
        </div>
        <header id="header">
            <h1>
                <span>DEVELOPER</span>
                <span>PORTFOLIO</span>
            </h1>
            <nav>
                <ul>
                    <li><a href="../index.html">001/Main</a></li>
                    <li><a href="work.html">002/Work</a></li>
                    <li><a href="test.html">003/Team</a></li>
                    <li><a href="#">004/Comment</a></li>
                    <li><a href="#">005/Contact</a></li>
                </ul>
            </nav>
        </header>
        <!-- //header -->
        <main id="main">
            <div class="title_box">
                <h1 class="title">work</h1>
                <div class="stack01">
                    <p>TECHNOLOGIES USED<br>
                        <span>JavaScript, React, Vue, PHP</span>
                    </p>
                </div>
                <div class="stack02">
                    <p>used skill<br>
                        <span>gsap,scss</span>
                    </p>
                </div>
            </div>
            <div class="carousel">
                <div class="carousel--wrap">
                    <div class="carousel--item">
                        <figure><img
                                src="https://images.unsplash.com/photo-1595265677860-9a3168007dc0?ixlib=rb-1.2.1&ixid=eyJhcHBfaWQiOjEyMDd9&auto=format&fit=crop&w=800&q=60"
                                alt="" /></figure>
                    </div>
                    <div class="carousel--item">
                        <div class="text-box">
                            <div class="text-detail">
                                <span class="text-detail-title">001 / React</span>
                                <span>테스트용입니다.</span>
                            </div>
                        </div>
                    </div>

                    <div class="carousel--item">
                        <figure><img
                                src="https://images.unsplash.com/photo-1594786118579-95ba90c801ec?ixlib=rb-1.2.1&ixid=eyJhcHBfaWQiOjEyMDd9&auto=format&fit=crop&w=800&q=60"
                                alt="" /></figure>
                    </div>
                    <div class="carousel--item">
                        <div class="text-box">
                            <div class="text-detail">
                                <span class="text-detail-title">001 / React</span>
                                <span>테스트용입니다.</span>
                            </div>
                        </div>
                    </div>

                    <div class="carousel--item">
                        <figure><img
                                src="https://images.unsplash.com/photo-1509339022327-1e1e25360a41?ixlib=rb-1.2.1&ixid=eyJhcHBfaWQiOjEyMDd9&auto=format&fit=crop&w=800&q=60"
                                alt="" /></figure>
                    </div>
                    <div class="carousel--item">
                        <div class="text-box">
                            <div class="text-detail">
                                <span class="text-detail-title">001 / React</span>
                                <span>테스트용입니다.</span>
                            </div>
                        </div>
                    </div>

                    <div class="carousel--item">
                        <figure><img
                                src="https://images.unsplash.com/photo-1525417071002-5ee4e6bb44f7?ixlib=rb-1.2.1&ixid=eyJhcHBfaWQiOjEyMDd9&auto=format&fit=crop&w=800&q=60"
                                alt="" /></figure>
                    </div>
                    <div class="carousel--item">
                        <div class="text-box">
                            <div class="text-detail">
                                <span class="text-detail-title">001 / React</span>
                                <span>테스트용입니다.</span>
                            </div>
                        </div>
                    </div>

                    <div class="carousel--item">
                        <figure><img
                                src="https://images.unsplash.com/photo-1594072702031-f0e2a602dd2c?ixlib=rb-1.2.1&ixid=eyJhcHBfaWQiOjEyMDd9&auto=format&fit=crop&w=800&q=60"
                                alt="" /></figure>
                    </div>
                    <div class="carousel--item">
                        <div class="text-box">
                            <div class="text-detail">
                                <span class="text-detail-title">001 / React</span>
                                <span>테스트용입니다.</span>
                            </div>
                        </div>
                    </div>

                    <div class="carousel--item">
                        <figure><img
                                src="https://images.unsplash.com/photo-1592989819277-a3aafa40c66a?ixlib=rb-1.2.1&ixid=eyJhcHBfaWQiOjEyMDd9&auto=format&fit=crop&w=800&q=60"
                                alt="" /></figure>
                    </div>
                    <div class="carousel--item">
                        <div class="text-box">
                            <div class="text-detail">
                                <span class="text-detail-title">001 / React</span>
                                <span>테스트용입니다.</span>
                            </div>
                        </div>
                    </div>

                    <div class="carousel--item">
                        <figure><img
                                src="https://images.unsplash.com/photo-1548374797-d13fd5d2b2a8?ixlib=rb-1.2.1&ixid=eyJhcHBfaWQiOjEyMDd9&auto=format&fit=crop&w=800&q=60"
                                alt="" /></figure>
                    </div>
                    <div class="carousel--item">
                        <div class="text-box">
                            <div class="text-detail">
                                <span class="text-detail-title">001 / React</span>
                                <span>테스트용입니다.</span>
                            </div>
                        </div>
                    </div>

                </div>
                <div class="carousel--progress">
                    <div class="carousel--progress-bar"></div>
                </div>
            </div>
        </main>
        <!-- //main -->
        <footer id="footer">
            <span>No SKIP</span>
            <span>No SKIP</span>
            <span>No SKIP</span>
            <span>No SKIP</span>
            <span>No SKIP</span>
            <span>No SKIP</span>
            <span>No SKIP</span>
            <span>No SKIP</span>
            <span>No SKIP</span>
            <span>No SKIP</span>
            <span>No SKIP</span>
            <span>No SKIP</span>
            <span>No SKIP</span>
            <span>No SKIP</span>
            <span>No SKIP</span>
            <span>No SKIP</span>
            <span>No SKIP</span>
            <span>No SKIP</span>
            <span>No SKIP</span>
            <span>No SKIP</span>
            <span>No SKIP</span>
            <span>No SKIP</span>
            <span>No SKIP</span>
        </footer>
        <!-- //footer -->
    </div>
    <script>
        const lerp = (f0, f1, t) => (1 - t) * f0 + t * f1
        const clamp = (val, min, max) => Math.max(min, Math.min(val, max))

        class DragScroll {
            constructor(obj) {
                this.$el = document.querySelector(obj.el)
                this.$wrap = this.$el.querySelector(obj.wrap)
                this.$items = this.$el.querySelectorAll(obj.item)
                this.$bar = this.$el.querySelector(obj.bar)
                this.init()
            }

            init() {
                this.progress = 0
                this.speed = 0
                this.oldX = 0
                this.x = 0
                this.playrate = 0
                //
                this.bindings()
                this.events()
                this.calculate()
                this.raf()
            }

            bindings() {
                [
                    'events',
                    'calculate',
                    'raf',
                    'handleWheel',
                    'move',
                    'raf',
                    'handleTouchStart',
                    'handleTouchMove',
                    'handleTouchEnd',
                ].forEach(i => { this[i] = this[i].bind(this) })
            }

            calculate() {
                this.progress = 0
                this.wrapWidth = this.$items[0].clientWidth * this.$items.length
                this.$wrap.style.width = `${this.wrapWidth}px`
                this.maxScroll = this.wrapWidth - this.$el.clientWidth
            }

            handleWheel(e) {
                this.progress += e.deltaY
                this.move()
            }

            handleTouchStart(e) {
                e.preventDefault()
                this.dragging = true
                this.startX = e.clientX || e.touches[0].clientX
                this.$el.classList.add('dragging')
            }

            handleTouchMove(e) {
                if (!this.dragging) return false
                const x = e.clientX || e.touches[0].clientX
                this.progress += (this.startX - x) * 2.5
                this.startX = x
                this.move()
            }

            handleTouchEnd() {
                this.dragging = false
                this.$el.classList.remove('dragging')
            }

            move() {
                this.progress = clamp(this.progress, 0, this.maxScroll)
            }

            events() {
                window.addEventListener('resize', this.calculate)
                window.addEventListener('wheel', this.handleWheel)
                //
                this.$el.addEventListener('touchstart', this.handleTouchStart)
                window.addEventListener('touchmove', this.handleTouchMove)
                window.addEventListener('touchend', this.handleTouchEnd)
                //
                window.addEventListener('mousedown', this.handleTouchStart)
                window.addEventListener('mousemove', this.handleTouchMove)
                window.addEventListener('mouseup', this.handleTouchEnd)
                document.body.addEventListener('mouseleave', this.handleTouchEnd)
                this.$items.forEach(item => {
                    item.addEventListener('mouseenter', this.handleMouseEnter)
                    item.addEventListener('mouseleave', this.handleMouseLeave)
                })
            }

            raf() {
                // requestAnimationFrame(this.raf)
                this.x = lerp(this.x, this.progress, 0.1)
                this.playrate = this.x / this.maxScroll
                //
                this.$wrap.style.transform = `translateX(${-this.x}px)`
                this.$bar.style.transform = `scaleX(${.18 + this.playrate * .82})`
                //
                this.speed = Math.min(100, this.oldX - this.x)
                this.oldX = this.x
                //
                this.scale = lerp(this.scale, this.speed, 0.1)
                this.$items.forEach(i => {
                    i.style.transform = `scale(${1 - Math.abs(this.speed) * 0.002})`
                    const img = i.querySelector('img');
                    if (img) {
                        img.style.transform = `scaleX(${1 + Math.abs(this.speed) * 0.004})`;
                    }

                    // 텍스트 박스 요소를 찾고, 존재하면 스케일 적용
                    const textBox = i.querySelector('.text-box');
                    if (textBox) {
                        textBox.style.transform = `scaleX(${1 + Math.abs(this.speed) * 0.004})`;
                    }
                })
            }
        }


        /*--------------------
        Instances
        --------------------*/
        const scroll = new DragScroll({
            el: '.carousel',
            wrap: '.carousel--wrap',
            item: '.carousel--item',
            bar: '.carousel--progress-bar',
        })


        /*--------------------
        One raf to rule em all
        --------------------*/
        const raf = () => {
            requestAnimationFrame(raf)
            scroll.raf()
        }
        raf()

    </script>
</body>

</html>